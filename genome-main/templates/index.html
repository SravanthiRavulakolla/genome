<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Genomic Interaction Predictor</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Poppins:wght@300;500;700&family=Raleway:wght@400;600&display=swap" rel="stylesheet">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        background-color: #f8f9fa;
        color: #333;
      }
      .header {
        background: linear-gradient(135deg, #6c5ce7 0%, #45aaf2 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .header h1 {
        font-family: 'Montserrat', sans-serif;
        color: white;
        font-weight: 700;
        letter-spacing: -0.5px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      }
      .header .lead {
        font-family: 'Raleway', sans-serif;
        font-weight: 400;
      }
      .card {
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
        border: none;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      .card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
      }
      .card-header {
        background-color: #f5f7fa;
        border-bottom: 1px solid #e2e8f0;
        font-weight: 600;
        border-radius: 10px 10px 0 0 !important;
        color: #6c5ce7;
        font-family: 'Raleway', sans-serif;
      }
      .form-label {
        font-weight: 500;
      }
      .btn-primary {
        background-color: #6c5ce7;
        border-color: #6c5ce7;
        transition: all 0.3s ease;
      }
      .btn-primary:hover {
        background-color: #5145cd;
        border-color: #5145cd;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(108, 92, 231, 0.3);
      }
      .result-card {
        display: none;
        transition: all 0.3s ease;
      }
      .result-card.show {
        display: block;
      }
      .prediction-yes {
        color: #00b894;
        font-weight: bold;
        font-size: 2.5rem;
        text-align: center;
        font-family: 'Montserrat', sans-serif;
        text-shadow: 0 1px 2px rgba(0, 184, 148, 0.2);
      }
      .prediction-no {
        color: #ff7675;
        font-weight: bold;
        font-size: 2.5rem;
        text-align: center;
        font-family: 'Montserrat', sans-serif;
        text-shadow: 0 1px 2px rgba(255, 118, 117, 0.2);
      }
      .match {
        color: #00b894;
      }
      .no-match {
        color: #ff7675;
      }
      .probability-bar {
        height: 20px;
        background-color: #dfe6e9;
        border-radius: 10px;
        overflow: hidden;
        margin-top: 5px;
      }
      .probability-fill {
        height: 100%;
        background: linear-gradient(90deg, #6c5ce7 0%, #45aaf2 100%);
        transition: width 0.5s ease;
      }
      .form-section {
        margin-bottom: 1.5rem;
      }
      .section-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #dfe6e9;
        font-family: 'Raleway', sans-serif;
      }
      #predictionExplanation {
        background-color: #f8f9fa;
        border-left: 4px solid #6c5ce7;
        padding: 0.75rem 1rem;
        margin-top: 1rem;
        border-radius: 0 5px 5px 0;
        font-family: 'Poppins', sans-serif;
        font-weight: 300;
        line-height: 1.6;
      }
      .about-section h4 {
        color: #574b90;
        font-weight: 700;
        font-family: 'Raleway', sans-serif;
      }
      .dataset-label {
        display: inline-block;
        background: linear-gradient(135deg, #6c5ce7 0%, #45aaf2 100%);
        color: white;
        font-weight: 600;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        margin-right: 0.5rem;
        font-size: 0.9rem;
        box-shadow: 0 2px 4px rgba(108, 92, 231, 0.3);
      }
      .form-control, .form-select {
        border-radius: 8px;
        padding: 0.5rem 0.75rem;
        border: 1px solid #dfe6e9;
        transition: all 0.3s ease;
      }
      .form-control:focus, .form-select:focus {
        border-color: currentColor;
        box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
      }
      .bi {
        color: #6c5ce7;
      }
      footer {
        background: linear-gradient(135deg, #6c5ce7 0%, #45aaf2 100%);
        color: white;
        font-family: 'Raleway', sans-serif;
        padding: 1.5rem 0;
        margin-top: 4rem;
        box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.05);
      }
      .card ul li {
        margin-bottom: 0.5rem;
        position: relative;
        padding-left: 1.5rem;
      }
      .card ul li:before {
        content: 'â€¢';
        color: #6c5ce7;
        font-weight: bold;
        position: absolute;
        left: 0;
        font-size: 1.2rem;
      }
      h2 {
        font-family: 'Raleway', sans-serif;
        color: #6c5ce7;
        font-weight: 600;
        margin-bottom: 1.5rem;
      }
      h3 {
        font-family: 'Montserrat', sans-serif;
        color: #e17055;
        font-weight: 600;
      }
      h4, h5, h6 {
        font-family: 'Poppins', sans-serif;
        color: #00b894;
      }
      
      /* Different colored section titles */
      .form-section:nth-child(1) .section-title {
        color: #00b894;
        border-bottom-color: #00b894;
      }
      .form-section:nth-child(2) .section-title {
        color: #e84393;
        border-bottom-color: #e84393;
      }
      .form-section:nth-child(3) .section-title {
        color: #fdcb6e;
        border-bottom-color: #fdcb6e;
      }
      
      /* Different colored form labels */
      .form-section:nth-child(1) .form-label {
        color: #00a885;
      }
      .form-section:nth-child(2) .form-label {
        color: #c2185b;
      }
      .form-section:nth-child(3) .form-label {
        color: #e17055;
      }
      
      /* Input field borders */
      .form-section:nth-child(1) .form-control, 
      .form-section:nth-child(1) .form-select {
        border-left: 3px solid #00b894;
      }
      .form-section:nth-child(2) .form-control, 
      .form-section:nth-child(2) .form-select {
        border-left: 3px solid #e84393;
      }
      .form-section:nth-child(3) .form-control, 
      .form-section:nth-child(3) .form-select {
        border-left: 3px solid #e17055;
      }
      
      /* Focus colors for inputs */
      .form-section:nth-child(1) .form-control:focus, 
      .form-section:nth-child(1) .form-select:focus {
        border-color: #00b894;
        box-shadow: 0 0 0 3px rgba(0, 184, 148, 0.1);
      }
      .form-section:nth-child(2) .form-control:focus, 
      .form-section:nth-child(2) .form-select:focus {
        border-color: #e84393;
        box-shadow: 0 0 0 3px rgba(232, 67, 147, 0.1);
      }
      .form-section:nth-child(3) .form-control:focus, 
      .form-section:nth-child(3) .form-select:focus {
        border-color: #e17055;
        box-shadow: 0 0 0 3px rgba(225, 112, 85, 0.1);
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="container">
        <h1 class="display-4">Genomic Interaction Predictor</h1>
        <p class="lead">
          Predict whether genomic interactions are significant based on
          supporting pairs, distance, and other features.
        </p>
      </div>
    </div>

    <div class="container">
      <div class="card mb-4">
        <div class="card-body about-section">
          <h4 class="mb-3">About This Predictor Tool</h4>
          <p>
            This tool predicts the significance of genomic interactions in the context of drug responses. Using machine learning, it analyzes patterns in Hi-C chromatin interaction data to determine if an interaction is functionally important.
          </p>
          <p>
            <span class="dataset-label">Dataset</span> This model was trained on breast cancer cell line data, analyzing how cells respond to cancer drugs (Gemcitabine and Carboplatin). The model achieves approximately 90% accuracy on test data.
          </p>
        </div>
      </div>

      <div class="row">
        <div class="col-lg-8">
          <div class="card">
            <div class="card-header">
              <i class="bi bi-input-cursor-text me-2"></i>Input Parameters
            </div>
            <div class="card-body">
              <form id="predictionForm">
                <div class="form-section">
                  <div class="section-title">Basic Information</div>
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <label for="IntGroup" class="form-label"
                        >Interaction Type</label
                      >
                      <select
                        class="form-select"
                        id="IntGroup"
                        name="IntGroup"
                        required
                      >
                        <option value="PP">PP (Promoter-Promoter)</option>
                        <option value="PD">PD (Promoter-Distal)</option>
                        <option value="DD">DD (Distal-Distal)</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label for="Strand" class="form-label">Strand</label>
                      <select
                        class="form-select"
                        id="Strand"
                        name="Strand"
                        required
                      >
                        <option value="+">+</option>
                        <option value="-">-</option>
                      </select>
                    </div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <label for="distance" class="form-label">Distance</label>
                      <input
                        type="number"
                        class="form-control"
                        id="distance"
                        name="distance"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="NofInts" class="form-label"
                        >Number of Interactions</label
                      >
                      <input
                        type="number"
                        class="form-control"
                        id="NofInts"
                        name="NofInts"
                        required
                      />
                    </div>
                  </div>
                </div>

                <div class="form-section">
                  <div class="section-title">Supporting Pairs</div>
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <label for="CG1_SuppPairs" class="form-label"
                        >CG1 Supporting Pairs</label
                      >
                      <input
                        type="number"
                        class="form-control"
                        id="CG1_SuppPairs"
                        name="CG1_SuppPairs"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="CG2_SuppPairs" class="form-label"
                        >CG2 Supporting Pairs</label
                      >
                      <input
                        type="number"
                        class="form-control"
                        id="CG2_SuppPairs"
                        name="CG2_SuppPairs"
                        required
                      />
                    </div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <label for="CC1_SuppPairs" class="form-label"
                        >CC1 Supporting Pairs</label
                      >
                      <input
                        type="number"
                        class="form-control"
                        id="CC1_SuppPairs"
                        name="CC1_SuppPairs"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="CC2_SuppPairs" class="form-label"
                        >CC2 Supporting Pairs</label
                      >
                      <input
                        type="number"
                        class="form-control"
                        id="CC2_SuppPairs"
                        name="CC2_SuppPairs"
                        required
                      />
                    </div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <label for="CN1_SuppPairs" class="form-label"
                        >CN1 Supporting Pairs</label
                      >
                      <input
                        type="number"
                        class="form-control"
                        id="CN1_SuppPairs"
                        name="CN1_SuppPairs"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="CN2_SuppPairs" class="form-label"
                        >CN2 Supporting Pairs</label
                      >
                      <input
                        type="number"
                        class="form-control"
                        id="CN2_SuppPairs"
                        name="CN2_SuppPairs"
                        required
                      />
                    </div>
                  </div>
                </div>

                <div class="form-section">
                  <div class="section-title">Annotations</div>
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <label for="Annotation" class="form-label"
                        >Annotation</label
                      >
                      <input
                        type="number"
                        class="form-control"
                        id="Annotation"
                        name="Annotation"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="InteractorAnnotation" class="form-label"
                        >Interactor Annotation</label
                      >
                      <input
                        type="number"
                        class="form-control"
                        id="InteractorAnnotation"
                        name="InteractorAnnotation"
                        required
                      />
                    </div>
                  </div>
                </div>

                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                  <button
                    type="button"
                    class="btn btn-outline-secondary me-md-2"
                    id="loadSampleBtn"
                  >
                    <i class="bi bi-download me-1"></i> Load Sample
                  </button>
                  <button type="submit" class="btn btn-primary">
                    <i class="bi bi-search me-1"></i> Predict
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <div class="col-lg-4">
          <div class="card result-card" id="resultCard">
            <div class="card-header">
              <i class="bi bi-graph-up me-2"></i>Prediction Result
            </div>
            <div class="card-body">
              <div class="mb-4">
                <h5>Predicted Significance:</h5>
                <h3 id="predictionResult" class="mb-3"></h3>
                <div id="predictionExplanation" class="mb-4 p-3 bg-light rounded"></div>
              </div>

              <div class="card">
                <div class="card-header">
                  <i class="bi bi-info-circle me-2"></i>About
                </div>
                <div class="card-body">
                  <p>
                    This tool uses a Random Forest model to predict whether genomic
                    interactions are significant based on supporting pairs,
                    distance, and other features.
                  </p>
                  <p>
                    The model achieves approximately 90% accuracy on the test set.
                  </p>
                  <p>Key features for prediction:</p>
                  <ul>
                    <li>Supporting pair counts</li>
                    <li>Number of interactions</li>
                    <li>Distance between interacting regions</li>
                    <li>Supporting pairs ratio between replicates</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="py-4 mt-5">
      <div class="container text-center">
        <p class="mb-0">Genomic Interaction Predictor &copy; 2025 | Advanced Bioinformatics Tool</p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("predictionForm");
        const resultCard = document.getElementById("resultCard");
        const predictionResult = document.getElementById("predictionResult");
        const loadSampleBtn = document.getElementById("loadSampleBtn");

        // Load a random sample from the dataset
        loadSampleBtn.addEventListener("click", function () {
          fetch("/sample")
            .then((response) => response.json())
            .then((data) => {
              if (data.error) {
                alert("Error loading sample: " + data.error);
                return;
              }

              // Fill the form with sample data
              for (const [key, value] of Object.entries(data)) {
                const input = document.getElementById(key);
                if (input) {
                  input.value = value;
                }
              }
            })
            .catch((error) => {
              console.error("Error:", error);
              alert("Error loading sample data");
            });
        });

        // Handle form submission
        form.addEventListener("submit", function (e) {
          e.preventDefault();

          const formData = new FormData(form);

          fetch("/predict", {
            method: "POST",
            body: formData,
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.error) {
                alert("Error: " + data.error);
                return;
              }

              // Display the result
              resultCard.classList.add("show");

              // Set prediction result
              predictionResult.textContent = data.prediction;
              predictionResult.className =
                data.prediction === "YES" ? "prediction-yes" : "prediction-no";
                
              // Add explanation text based on prediction
              const explanationDiv = document.getElementById("predictionExplanation");
              if (data.prediction === "YES") {
                explanationDiv.innerHTML = `
                  <p>This genomic interaction is predicted to be biologically significant.</p>
                  <p>This means the observed genomic interaction is likely due to the drug's effect, and not by chance.</p>
                `;
              } else {
                explanationDiv.innerHTML = `
                  <p>This genomic interaction is predicted to be non-significant.</p>
                  <p>This means the observed genomic interaction is likely random or due to other factors, and not caused by the drug.</p>
                `;
              }
            })
            .catch((error) => {
              console.error("Error:", error);
              alert("Error making prediction");
            });
        });
      });
    </script>
  </body>
</html>
